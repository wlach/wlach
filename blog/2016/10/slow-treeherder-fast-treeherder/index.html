<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8" />
    <title>Slow Treeherder, Fast Treeherder</title>
    <meta name="description" content="Just wanted to talk about some recent performance improvements we've made recently to Treeherder:   Bug 1311511: Changed the repository endpoint so we don't do 40 redundant database  queries (this was generally innocuous, but could delay loading by  400ms..." />
    <meta name="author" content="William Lachance" />
    <meta name="keywords" content="Mozilla, Treeherder, Performance" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="canonical" href="https://wrla.ch/blog/2016/10/slow-treeherder-fast-treeherder/" />
    <link rel="next" href="/blog/2016/08/herding-automation-infrastructure/" /> <link rel="prev" href="/blog/2016/11/training-an-autoclassifier/" />
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/pygments.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/scribble.css"
    />
    <!-- Feeds -->
    <link
      rel="alternate"
      type="application/atom+xml"
      href="/feeds/all.atom.xml"
      title="Atom Feed"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      href="/feeds/all.rss.xml"
      title="RSS Feed"
    />
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <nav
      class="flex items-center justify-between flex-wrap bg-gray-800 py-1 px-8"
    >
      <div class="flex items-center flex-shrink-0 text-gray-400 mr-6">
        <div class="p-1">
          <a href="/index.html"
            ><img
              src="/img/wlach_icon.png"
              width="32"
              height="32"
              class="p rounded"
          /></a>
        </div>
        <div class="p-1">
          <a
            href="/index.html"
            class="text-gray-200 font-semibold text-xl tracking-tight hover:text-white"
            >wlach log</a
          >
        </div>
      </div>
      <div class="flex-grow lg:flex lg:items-center">
        <div class="text-sm lg:flex-grow">
          <a
            href="/About.html"
            class="mt-4 lg:inline-block lg:mt-0 hover:text-white mr-4 text-gray-600"
          >
            About</a>
          <a
            class="mt-4 lg:inline-block lg:mt-0 text-gray-600 hover:text-white mr-4"
            href="/feeds/all.atom.xml"
            >Atom</a
          >
          <a
            class="mt-4 lg:inline-block lg:mt-0 text-gray-600 hover:text-white mr-4"
            href="/feeds/all.rss.xml"
            >RSS</a
          >
        </div>
      </div>
    </nav>
    <div id="content" class="container max-w-screen-md px-8 py-4 mx-auto">
         <article>
  <header>
    <h1>Slow Treeherder, Fast Treeherder</h1>
    <p class="index-date">Oct 3131, 2016</p>
    <p><span class="tags"><a href="/tags/Mozilla.html">Mozilla</a>  <a href="/tags/Treeherder.html">Treeherder</a>  <a href="/tags/Performance.html">Performance</a></span></p>
  </header>

<p>Just wanted to talk about some recent performance improvements we&rsquo;ve made recently to <a href="https://wiki.mozilla.org/EngineeringProductivity/Projects/Treeherder">Treeherder</a>:</p>

<ul>
 <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1311511">Bug 1311511</a>: Changed the repository endpoint so we don&rsquo;t do 40 redundant database  queries (this was generally innocuous, but could delay loading by  400ms if the database was under heavy load).</li>
 <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1310016">Bug 1310016</a>: Persisted database connections across requests (this  can save ~40&ndash;50ms per request, of which there can be 5&ndash;10  when loading a Treeherder page).</li>
 <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1308782">Bug 1308782</a>: <em>Don&rsquo;t</em> download job type and group information  from the server to get a &ldquo;sorting order&rdquo; for the job lists. This was  never necessary, but it&rsquo;s gotten exponentially more painful as  people have added job types to Treeherder (job type information is  now around a megabyte of JSON these days). This saves 5&ndash;10 seconds on a  typical page load.</li></ul>

<p>There&rsquo;s more to come, but with these changes Treeherder should be faster for everyone to load. It should be particularly noticeable on try pushes, where the last item was by far the largest bottleneck. Here&rsquo;s a youtube video of the changes:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/xNJGoZhA4Vs" frameborder="0" allowfullscreen="allowfullscreen"></iframe>

<p>The original is on the left. The newer, faster Treeherder is on the right. Pay particular attention to how much faster the job information populates.</p>

<p>Moral of the story? Optimization can be helpful, but it&rsquo;s better if you can avoid doing the work altogether.</p>
  <hr/>
</article>
    </div>
    <footer class="container max-w-screen-md px-8 py-4 mx-auto less-important">
      <p>Comments / thoughts? Feel free to send an email to wlach on protonmail.com or
        (for Mozilla-related stuff) reach me at <code>wlach</code> on <a href="https://wiki.mozilla.org/Matrix">Mozilla's instance of Matrix</a>.</p>
      <p>
        Site generated by
        <a href="https://github.com/greghendershott/frog">Frog</a>.
        Post content is licensed under a
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
          >Creative Commons Attribution 4.0 Unported License</a
        >.
      </p>
    </footer>
  </body>
</html>