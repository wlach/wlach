<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Posts tagged 'Mozilla' (page 4)</title>
    <meta name="description" content="Posts tagged 'Mozilla' (page 4)">
    <meta name="author"      content="William Lachance">
    <meta name="keywords"    content="Mozilla">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/favicon.ico">
    <link rel="canonical" href="https://wlach.github.io/tags/Mozilla-4.html">


    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/Mozilla.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/Mozilla.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <!-- A standard Twitter Bootstrap nav bar -->
    <header class="navbar navbar-default navbar-inverse"
            role="banner">
      <div class="container">
        <div class="navbar-header">
          <button type="button"
                  class="navbar-toggle"
                  data-toggle="collapse"
                  data-target=".our-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/index.html" class="navbar-brand">William Lachance's Log</a>
        </div>
        <div class="collapse navbar-collapse our-nav-collapse"
             role="navigation">
          <ul class="nav navbar-nav">

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">All Posts</a></li>

<li><a href="/tags/Android.html">Android</a></li>

<li><a href="/tags/ateam.html">ateam</a></li>

<li><a href="/tags/BIXI.html">BIXI</a></li>

<li><a href="/tags/Buddhism.html">Buddhism</a></li>

<li><a href="/tags/Business.html">Business</a></li>

<li><a href="/tags/Cats.html">Cats</a></li>

<li><a href="/tags/Coffee.html">Coffee</a></li>

<li><a href="/tags/Community.html">Community</a></li>

<li><a href="/tags/Data-Visualization.html">Data Visualization</a></li>

<li><a href="/tags/Ebola.html">Ebola</a></li>

<li><a href="/tags/Eideticker.html">Eideticker</a></li>

<li><a href="/tags/email.html">email</a></li>

<li><a href="/tags/Environment.html">Environment</a></li>

<li><a href="/tags/FirefoxOS.html">FirefoxOS</a></li>

<li><a href="/tags/Food.html">Food</a></li>

<li><a href="/tags/Free-Software.html">Free Software</a></li>

<li><a href="/tags/GNOME.html">GNOME</a></li>

<li><a href="/tags/GoFaster.html">GoFaster</a></li>

<li><a href="/tags/hbus.html">hbus</a></li>

<li><a href="/tags/Infraherder.html">Infraherder</a></li>

<li><a href="/tags/iphone.html">iphone</a></li>

<li><a href="/tags/Life.html">Life</a></li>

<li><a href="/tags/Meditation.html">Meditation</a></li>

<li><a href="/tags/Meta.html">Meta</a></li>

<li><a href="/tags/Montreal.html">Montreal</a></li>

<li><a href="/tags/Mozilla.html">Mozilla</a></li>

<li><a href="/tags/mozregression.html">mozregression</a></li>

<li><a href="/tags/MSF.html">MSF</a></li>

<li><a href="/tags/Music.html">Music</a></li>

<li><a href="/tags/Nixi.html">Nixi</a></li>

<li><a href="/tags/Open-Data.html">Open Data</a></li>

<li><a href="/tags/Orangutan.html">Orangutan</a></li>

<li><a href="/tags/Pandaboard.html">Pandaboard</a></li>

<li><a href="/tags/Perfherder.html">Perfherder</a></li>

<li><a href="/tags/Philosophy.html">Philosophy</a></li>

<li><a href="/tags/Profiling.html">Profiling</a></li>

<li><a href="/tags/Python.html">Python</a></li>

<li><a href="/tags/Release-Engineering.html">Release Engineering</a></li>

<li><a href="/tags/Responsiveness.html">Responsiveness</a></li>

<li><a href="/tags/SQL.html">SQL</a></li>

<li><a href="/tags/Talos.html">Talos</a></li>

<li><a href="/tags/Time.html">Time</a></li>

<li><a href="/tags/Toronto.html">Toronto</a></li>

<li><a href="/tags/Transit.html">Transit</a></li>

<li><a href="/tags/Transit-to-Go.html">Transit to Go</a></li>

<li><a href="/tags/Usability.html">Usability</a></li>

<li><a href="/tags/Video.html">Video</a></li>

<li><a href="/tags/Web.html">Web</a></li>

<li><a href="/tags/WifiDog.html">WifiDog</a></li>

<li><a href="/tags/zen.html">zen</a></li>

<li><a href="/tags/Île-Sans-Fil.html">Île Sans Fil</a></li>
              </ul>
            </li>
            <li>
              <a href="/About.html">About</a>
            </li> 
            <li><a href="/feeds/Mozilla.atom.xml">Atom</a></li>
            <li><a href="/feeds/Mozilla.rss.xml">RSS</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">

        <!-- Main column -->
        <div id="content" class="col-md-12">

          <h1>Posts tagged <em>Mozilla</em></h1>

          <article>
  <header>
    <p><span class="tags"><a href="/tags/Android.html">Android</a>, <a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a>, <a href="/tags/Time.html">Time</a></span></p>
    <h2><a href='/blog/2013/07/simple-command-line-ntp-client-for-android-and-firefoxos/'>Simple command-line ntp client for Android and FirefoxOS</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Jul 8th, 2013</p>
  </header>

<p>Today I did a quick port of Larry Doolittle&#8217;s <a href="http://doolittle.icarus.com/ntpclient/">ntpclient program</a> to Android and FirefoxOS. Basically this lets you easily synchronize your device&#8217;s time to that of a central server. Yes, there&#8217;s lots and lots of Android &#8220;applications&#8221; which let you do this, but I wanted to be able to do this from the command line because that&#8217;s how I roll. If you&#8217;re interested, source and instructions are here:</p>

<p><a href="https://github.com/wlach/ntpclient-android">https://github.com/wlach/ntpclient-android</a></p>

<p>For those curious, no, I didn&#8217;t just do this for fun. For next quarter, we want to write some Eideticker-based responsiveness tests for FirefoxOS and Android. For example, how long does it take from the time you tap on an icon in the homescreen on FirefoxOS to when the application is fully loaded? Or on Android, how long does it take to see a full list of sites in the awesomebar from the time you tap on the URL field and enter your search term?</p>

<p>Because an Eideticker test run involves two different machines (a host machine which controls the device and captures video of it in action, as well as the device itself), we need to use timestamps to really understand when and how events are being sent to the device. To do that reliably, we really need some easy way of synchronizing time between two machines (or at least accounting for the difference in their clocks, which amounts to about the same thing). NTP struck me as being the easiest, most standard way of doing this.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/05/proof-of-concept-eideticker-dashboard-for-firefoxos/'>Proof of concept Eideticker dashboard for FirefoxOS</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> May 6th, 2013</p>
  </header>

<p><em>[ For more information on the Eideticker software I&#8217;m referring to, see <a href="http://wrla.ch/blog/2012/06/mobile-firefox-measuring-how-a-browser-feels/">this entry</a> ]</em></p>

<p>I just put up a proof of concept Eideticker dashboard for FirefoxOS <a href="http://eideticker.wrla.ch/b2g">here</a>. Right now it has two days worth of data, manually sampled from an Unagi device running b2g18. Right now there are two tests: one the measures the &#8220;speed&#8221; of the contacts application scrolling, another that measures the amount of time it takes for the contacts application to be fully loaded.</p>

<p>For those not already familiar with it, Eideticker is a benchmarking suite which captures live video data coming from a device and analyzes it to determine performance. This lets us get data which is more representative of actual user experience (as opposed to an oft artificial benchmark). For example, Eideticker measures contacts startup as taking anywhere between 3.5 seconds and 4.5 seconds, versus than the 0.5 to 1 seconds that the <a href="https://datazilla.mozilla.org/b2g/?branch=master&amp;#038;range=7&amp;#038;test=cold_load_time&amp;#038;app_list=contacts&amp;#038;app=contacts&amp;#038;gaia_rev=114bf216de0a19f7&amp;#038;gecko_rev=9c0de2afd22a8476">existing datazilla benchmarks</a> show. What accounts for the difference? If you step through an eideticker-captured video, you can see that even though <em>something</em> appears very quickly, not all the contacts are displayed until the 3.5 second mark. There is a gap between an app being reported as &#8220;loaded&#8221; and it being fully available for use, which we had not been measuring until now.</p>

<p>At this point, I am most interested in hearing from FirefoxOS developers on new tests that would be interesting and useful to track performance of the system on an ongoing basis. I&#8217;d obviously prefer to focus on things which have been difficult to measure accurately through other means. My setup is rather fiddly right now, but hopefully soon we can get some useful numbers going on an ongoing basis, as we <a href="http://eideticker.wrla.ch">do already</a> for Firefox for Android.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/04/actual-useful-firefoxos-eideticker-results-at-last/'>Actual useful FirefoxOS Eideticker results at last</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Apr 22nd, 2013</p>
  </header>

<p>Another update on getting <a href="http://wrla.ch/blog/2013/02/eideticker-for-firefoxos/">Eideticker working with FirefoxOS</a>. Once again this is sort of high-level, looking forward to writing something more in-depth soon now that we have the basics working.</p>

<p>I finally got the last kinks out of the rig I was using to capture live video from FirefoxOS phones using the Point Grey devices last week. In order to make things reasonable I had to write some custom code to isolate the actual device screen from the rest of capture and a few other things. The setup looks interesting (reminds me a bit of something out of the War of the Worlds):</p>

<p><a href="/files/2013/04/eideticker-pointgrey-mounted.jpg"><img src="/files/2013/04/eideticker-pointgrey-mounted.jpg" alt="eideticker-pointgrey-mounted" width="512" height="683" class="alignnone size-full wp-image-894" srcset="/files/2013/04/eideticker-pointgrey-mounted-224x300.jpg 224w, /files/2013/04/eideticker-pointgrey-mounted.jpg 512w" sizes="(max-width: 512px) 100vw, 512px" /></a></p>

<p>Here&#8217;s some example video of a test I wrote up to measure the performance of contacts scrolling performance (measured at a very respectable 44 frames per second, in case you wondering):</p>

<video src="/files/eideticker/contacts-scrolling-pointgrey.webm" controls="controls"></video>

<p>Surprisingly enough, I didn&#8217;t wind up having to write up any code to compensate for a noisy image. Of course there&#8217;s a certain amount of variance in every frame depending on how much light is hitting the camera sensor at any particular moment, but apparently not enough to interfere with getting useful results in the tests I&#8217;ve been running.</p>

<p>Likely next step: Create some kind of chassis for mounting both the camera and device on a permanent basis (instead of an adhoc one on my desk) so we can start running these sorts of tests on a daily basis, much like we currently do with Android on the <a href="http://eideticker.wrla.ch">Eideticker Dashboard</a>.</p>

<p>As an aside, I&#8217;ve been really impressed with both the <a href="https://wiki.mozilla.org/Auto-tools/Projects/Marionette">Marionette</a> framework and the gaiatests python module that was written up for FirefoxOS. Writing the above test took just 5 minutes &#8212; and <a href="https://github.com/mozilla/eideticker/blob/master/src/tests/b2g/appscrolling/scroll.py">the code</a> is quite straightforward. Quite the pleasant change from my various efforts in Android automation.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Android.html">Android</a>, <a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/03/eideticker-limitations-in-cross-browser-performance-testing/'>Eideticker: Limitations in cross-browser performance testing</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Mar 20th, 2013</p>
  </header>

<p>Last summer I <a href="http://wrla.ch/blog/2012/06/mobile-firefox-measuring-how-a-browser-feels/">wrote a bit</a> about using <a href="https://wiki.mozilla.org/Project_Eideticker">Eideticker</a> to measure the relative performance of Firefox for Android versus other browsers (Chrome, stock, etc.). At the time I was pretty optimistic about Eideticker&#8217;s usefulness as a truly &#8220;objective&#8221; measure of user experience that would give us a more accurate view of how we compared against the competition than traditional benchmarking suites (which more often than not, measure things that a user will never see normally when browsing the web). Since then, there&#8217;s been some things that I&#8217;ve discovered, as well as some developments in terms of the &#8220;state of the art&#8221; in mobile browsing that have caused me to reconsider that view &#8212; while I haven&#8217;t given up entirely on this concept (and I&#8217;m still very much convinced of eideticker&#8217;s utility as an internal benchmarking tool), there&#8217;s definitely some limitations in terms of what we can do that I&#8217;m not sure how to overcome.</p>

<p>Essentially, there are currently three different types of Eideticker performance tests:</p>

<ul>
 <li>Animation tests: Measure the smoothness of an animation by comparing frames and seeing how many are different. Currently the only example of this is the <a href="http://eideticker.wrla.ch/#/samsung-gn/clock/fps">canvas &#8220;clock&#8221; test</a>, but many others are possible.</li>
 <li>Startup tests: Measure the amount of time it takes from when the application is launched to when the browser is fully running/available. There are currently two variants of this test in the dashboard, both measure the amount of time taken to fully render Firefox&#8217;s home screen (the only difference between the two is whether the browser profile is fully initialized). The <a href="http://eideticker.wrla.ch/#/samsung-gn/startup-abouthome-dirty/timetostableframe">dirty profile</a> benchmark probably most closely resembles what a user would usually experience.</li>
 <li>Scrolling tests: Measure the amount of undrawn areas when the user is panning a website. Most of the current eideticker tests are of this kind. A good example of this is the <a href="http://eideticker.wrla.ch/#/samsung-gn/taskjs/fps">taskjs benchmark</a>.</li></ul>

<p>In this blog post, I&#8217;m going to focus on startup and scrolling tests. Animation tests are interesting, but they are also generally the sorts of tests that are easiest to measure in synthetic ways (e.g. by putting a frame counter in your javascript code) and have thus far not been a huge focus for Eideticker development.</p>

<p>As it turns out, it&#8217;s unfortunately been rather difficult to create truly objective tests which measure the difference between browsers in these two categories. I&#8217;ll go over them in order.</p>

<p><strong>Startup tests</strong></p>

<p>There are essentially two types of startup tests: one where you measure the amount of time to get to the browser&#8217;s home screen when you explicitly launch the app (e.g. by pressing the Firefox icon in the app chooser), another where you load a web page in a browser from another app (e.g. by clicking on a link in the Twitter application).</p>

<p>The first is actually fairly easy to test across browsers, although we are not currently. There&#8217;s not really a good reason for that, it was just an oversight, so I filed <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=852744">bug 852744</a> to add something like this.</p>

<p>The second case (startup to the browser&#8217;s homescreen) is a bit more difficult. The problem here is that, in a nutshell, an apples to apples comparison is very difficult if not impossible simply because different browsers do different things when the user presses the application icon. Here&#8217;s what we see with Firefox:</p>

<p><img src="/files/eideticker/firefox-startup.png" style="width:25%;" /></p>

<p>And here&#8217;s what we see with Chrome:</p>

<p><img src="/files/eideticker/chrome-startup.png" style="width:25%;" /></p>

<p>And here&#8217;s what we see with the stock browser:</p>

<p><img src="/files/eideticker/stock-startup.png" style="width:25%;" /></p>

<p>As you can see Chrome and the stock browser are totally different: they try to &#8220;restore&#8221; the browser back to its state from the last time (in Chrome&#8217;s case, I was last visiting taskjs.org, in Stock&#8217;s case, I was just on the homepage).</p>

<p>Personally I prefer Firefox&#8217;s behaviour (generally I want to browse somewhere new when I press the icon on my phone), but that&#8217;s really beside the point. It&#8217;s possible to hack around what chrome is doing by restoring the profile between sessions to some sort of clean &#8220;new tab&#8221; state, but at that point you&#8217;re not really reproducing a realistic user scenario. Sure, we can draw a comparison, but how valid is it really? It seems to me that the comparison is mostly only useful in a very broad &#8220;how quickly does the user see something useful&#8221; sense.</p>

<p><strong>Panning tests</strong></p>

<p>I had quite a bit of hope for these initially. They seemed like a place where Eideticker could do something that conventional benchmarking suites couldn&#8217;t, as things like panning a web page are not presently possible to do in JavaScript. The main measure I tried to compare against was something called &#8220;checkerboarding&#8221;, which essentially represents the amount of time that the user waits for the page to redraw when panning around.</p>

<p>At the time that I wrote these tests, most browsers displayed regions that were not yet drawn while panning using the page background. We figured that it would thus be possible to detect regions of the page which were not yet drawn by looking for the background color while initiating a panning action. I thus hacked up existing web pages to have a magenta background, then wrote some image analysis code to detect regions that were that color (under the assumption that magenta is only rarely seen in webpages). It worked pretty well.</p>

<p>The world&#8217;s moved on a bit since I wrote that: modern browsers like Chrome and Firefox use something like progressive drawing to display a lower resolution &#8220;tile&#8221; where possible in this case, so the user at least sees something resembling the actual page while panning on a slower device. To see what I mean, try visiting a slow-to-render site like taskjs.org and try panning down quickly. You should see something like this (click to expand):</p>

<p><a href="/files/eideticker/firefox-partialy-drawn.png"><img src="/files/eideticker/firefox-partialy-drawn.png" style="width:50%;" /></a></p>

<p>Unfortunately, while this is certainly a better user experience, it is not so easy to detect and measure. For Firefox, we&#8217;ve disabled this behaviour so that we see the old checkerboard pattern. This is useful for our internal measurements (we can see both if our drawing code as well as our heuristics about when to draw are getting better or worse over time) but it only works for us.</p>

<p>If anyone has any suggestions on what to do here, let me know as I&#8217;m a bit stuck. There are other metrics we could still compare against (i.e. how smooth is the panning animation aka frames per second?) but these aren&#8217;t nearly as interesting.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Android.html">Android</a>, <a href="/tags/ateam.html">ateam</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/03/documentation-for-mozdevice/'>Documentation for mozdevice</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Mar 11th, 2013</p>
  </header>

<p>Just wanted to give a quick heads up that as part of the ateam&#8217;s ongoing effort to improve the documentation of our automated testing infrastructure, we now have <a href="https://mozbase.readthedocs.org/en/latest/mozdevice.html">online documentation</a> for mozdevice, the python library we use for interacting with Android- and FirefoxOS-based devices in automated testing.</p>

<p>Mozdevice is used in pretty much every one of our testing frameworks that has mobile support, including mochitest, reftest, <a href="https://wiki.mozilla.org/Buildbot/Talos">talos</a>, <a href="https://github.com/mozilla/autophone">autophone</a>, and <a href="https://wiki.mozilla.org/Project_Eideticker">eideticker</a>. Additionally, mozdevice is used by release engineering to clean up, monitor, and otherwise manage 
 <strike>our hundred-odd</strike> the 1200*** tegra and panda development boards that we use in <a href="http://tbpl.mozilla.org">tbpl</a>. See <a href="https://hg.mozilla.org/build/tools/file/tip/sut_tools">sut_tools</a> (old, buildbot-based, what we currently use) and <a href="https://github.com/mozilla/mozpool">mozpool</a> (the new and shiny future).</p>

<ul>
 <li>Thanks to Dustin Mitchell for the correction.</li></ul>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/03/follow-up-on-8220-finding-a-camera-for-eideticker-8221/'>Follow up on &#8220;Finding a Camera for Eideticker&#8221;</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Mar 8th, 2013</p>
  </header>

<p>Quick update on my <a href="http://wrla.ch/blog/2013/02/finding-a-camera-for-eideticker/">last post</a> about finding some kind of camera suitable for use in automated performance testing of fennec and b2g with eideticker. Shortly after I wrote that, I found out about a company called <a href="http://ptgrey.com">Point Grey Research</a> which manufactures custom web cameras intended for exactly the sorts of things we&#8217;re doing. Initial results with the <a href="http://ww2.ptgrey.com/USB3/Flea3">Flea3 camera</a> I ordered from them are quite promising:</p>

<video width="400px" src="/files/eideticker/pointgrey-taskjs.webm" controls="controls"></video>

<p>(the actual capture is even higher quality than that would suggest&#8230; some detail is lost in the conversion to webm)</p>

<p>There seems to be some sort of issue with the white balance in that capture which is causing a flashing effect (I suspect this just involves flipping some kind of software setting&#8230; still trying to grok their SDK), and we&#8217;ll need to create some sort of enclosure for the setup so ambient light doesn&#8217;t interfere with the capture&#8230; but overall I&#8217;m pretty optimistic about this baby. 60 frames per second, very high resolution (1280&#215;960), no issues with HDMI (since it&#8217;s just a USB camera), relatively inexpensive.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/02/finding-a-camera-for-eideticker/'>Finding a camera for Eideticker</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Feb 19th, 2013</p>
  </header>

<p><em>[ For more information on the Eideticker software I&#8217;m referring to, see <a href="http://wrla.ch/blog/2012/06/mobile-firefox-measuring-how-a-browser-feels/">this entry</a> ]</em></p>

<p>Ok, so as I mentioned <a href="http://wrla.ch/blog/2013/02/eideticker-for-firefoxos/">last time</a> I&#8217;ve been looking into making Eideticker work for devices without native HDMI output by capturing their output with some kind of camera. So far I&#8217;ve tried four different DSLRs for this task, which have all been inadequate for different reasons. I was originally just going to write an email about this to a few concerned parties, but then figured I may as well structure it into a blog post. Maybe someone will find it useful (or better yet, have some ideas.)</p>

<p><strong>Elmo MO&ndash;1</strong></p>

<p>This is the device I mentioned last time. Easy to set up, plays nicely with the Decklink capture card we&#8217;re using for Eideticker. It seemed almost perfect, except for that:</p>

<ol>
 <li>The image quality is <em>really</em> bad (beaten even by $200 standard digital camera). Tons of noise, picture quality really bad. Not *necessarily* a deal breaker, but it still sucks.</li>
 <li>More importantly, there seems to be no way of turning off the auto white balance adjustment. This makes automated image analysis impossible if the picture changes, as is highlighted in this video:   
  <video width="400px" src="/files/eideticker/elmo-white-balance-problem.webm" controls="controls"></video></li></ol>

<p><strong>Canon Rebel T4i</strong></p>

<p>This is the first camera that was recommended to me at the camera shop I&#8217;ve been going to. It does have an HDMI output signal, but it&#8217;s not &#8220;clean&#8221;. This <a href="http://www.hireacamera.com/blog/index.asp?post=canon-eos-650d--hdmi-explained">blog post</a> explains the details better than I could. Next.</p>

<p><strong>Nikon D600</strong></p>

<p>Supposedly does native clean 720p output, but unfortunately the <a href="http://vimeo.com/49952287">output is in a &#8220;box&#8221;</a> so isn&#8217;t recognized by the Decklink cards that we&#8217;re using (which insist on a full 1280&#215;720 HDMI signal to work). Next.</p>

<p><strong>Nikon D800</strong></p>

<p>It is possible to configure this one to not put a box around the output, so the Decklink card does recognize it. Except that the camera shuts off the HDMI signal whenever the input parameters change on the card or the signal input is turned on, which essentially makes it useless for Eideticker (this happens every time we start the Eideticker harness). Quite a shame, as the HDMI signal is quite nice otherwise.</p>

<p>&#8212;</p>

<p>To be clear, with the exception of the Elmo all the devices above seem like fine cameras, and should more than do for manual captures of B2G or Android phones (which is something we probably want to do anyway). But for Eideticker, we need something that works in automation, and none of the above fit the bill. I guess I could explore using a &#8220;real&#8221; video camera as opposed to a DSLR acting like one, though I suspect I might run into some of the same sorts of issues depending on how the HDMI output of those devices behaves.</p>

<p>Part of me wonders whether a custom solution wouldn&#8217;t work better. How complicated could it be to construct your own digital camera anyway? 😉 Hook up a fancy camera sensor to a <a href="http://pandaboard.org">pandaboard</a>, get it to output through the HDMI port, and then we&#8217;re set? Or better yet, maybe just get a fancy webcam like the <a href="http://en.wikipedia.org/wiki/PlayStation_Eye">Playstation Eye</a> and hook it up directly to a computer? That would eliminate the need for our expensive video capture card setup altogether.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Eideticker.html">Eideticker</a>, <a href="/tags/FirefoxOS.html">FirefoxOS</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2013/02/eideticker-for-firefoxos/'>Eideticker for FirefoxOS</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Feb 1st, 2013</p>
  </header>

<p><em>[ For more information on the Eideticker software I&#8217;m referring to, see <a href="http://wrla.ch/blog/2012/06/mobile-firefox-measuring-how-a-browser-feels/">this entry</a> ]</em></p>

<p>Here&#8217;s a long overdue update on where we&#8217;re at with Eideticker for FirefoxOS. While we&#8217;ve had a good amount of success getting <a href="http://eideticker.wrla.ch">useful, actionable data</a> out of Eideticker for Android, so far we haven&#8217;t been able to replicate that success for FirefoxOS. This is not for lack of trying: first, <a href="http://nakubu.com/">Malini Das</a> and then me have been working at it since summer 2012.</p>

<p>When it comes right down to it, instrumenting Eideticker for B2G is just a whole lot more complex. On Android, we could take the operating system (including support for all the things we needed, like HDMI capture) as a given. The only tricky part was instrumenting the capture so the right things happened at the right moment. With FirefoxOS, we need to run these tests on entire builds of a whole operating system which was constantly changing. Not nearly as simple. That said, I&#8217;m starting to see light at the end of the tunnel.</p>

<p><strong>Platforms</strong></p>

<p>We initially selected the <a href="http://pandaboard.org">pandaboard</a> as the main device to use for eideticker testing, for two reasons. First, it&#8217;s the same hardware platform we&#8217;re targeting for other b2g testing in tbpl (mochitest, reftest, etc.), and is the platform we&#8217;re using for running Gaia UI tests. Second, unlike every other device that we&#8217;re prototyping FirefoxOS on (to my knowledge), it has HDMI-out capability, so we can directly interface it with the Eideticker video capture setup.</p>

<p>However, the panda also has some serious shortcomings. First, it&#8217;s obviously not a platform we&#8217;re shipping, so the performance we&#8217;re seeing from it is subject to different factors that we might not see with a phone actually shipped to users. For the same reason, we&#8217;ve had many problems getting B2G running reliably on it, as it&#8217;s not something most developers have been hacking on a day to day basis. Thanks to the heroic efforts of Thomas Zimmerman, we&#8217;ve mostly got things working ok now, but it was a fairly long road to get here (several months last fall).</p>

<p>More recently, we became aware of something called an <a href="http://www.elmousa.com/">Elmo</a> which might let us combine
 <br />the best of both worlds. An elmo is really just a tiny mounted video camera with a bunch of outputs, and is I understand most commonly used to project documents in a classroom/presentation setting. However, it seems to do a great job of capturing mobile phones in action as well.</p>

<video width="400px" src="/files/eideticker/startup-test-elmo.webm" controls="controls"></video>

<p>The nice thing about using an external camera for the video capture part of eideticker is that we are no longer limited to devices with HDMI out &#8212; we can run the standard set of automated tests on ANYTHING. We&#8217;ve already used this to some success in getting some videos of FirefoxOS startup times versus Android on the Unagi (a development phone that we&#8217;re using internally) for manual analysis. Automating this process may be trickier because of the fact that the video capture is no longer &#8220;perfect&#8221;, but we may be able to work around that (more discussion about this later).</p>

<p><strong>FirefoxOS web page tests</strong></p>

<p>These are the same tests we run on Android. They should give us an idea of roughly where our performance when browsing / panning web sites like CNN. So far, I&#8217;ve only run these tests on the Pandaboard and they are INCREDIBLY slow (like 1&ndash;3 frames per second when scrolling). So much so that I have to think there is something broken about our hardware acceleration on this platform.</p>

<p><strong>FirefoxOS application tests</strong></p>

<p>These are some new tests written in a framework that allows you to script arbitrary interactions in FirefoxOS, like launching applications or opening the task switcher.</p>

<p>I&#8217;m pretty happy with this. It seems to work well. The only problems I&#8217;m seeing with this is with the platform we&#8217;re running these tests on. With the pandaboard, applications look weird (since the screen resolution doesn&#8217;t remotely resemble the 320&#215;480 resolution on our current devices) and performance is abysmal. Take, for example, this capture of application switching performance, which operates only at roughly 3&ndash;4 fps:</p>

<video width="400px" src="/files/eideticker/b2g-appswitching-video.webm" controls="controls"></video>

<p><strong>So what now?</strong></p>

<p>I&#8217;m not 100% sure yet (partly it will depend on what others say as well as my own investigation), but I have a feeling that capturing video of real devices running FirefoxOS using the Elmo is the way forward. First, the hardware and driver situation will be much more representative of what we&#8217;ll actually be shipping to users. Second, we can flash new builds of FirefoxOS onto them automatically, unlike the pandaboards where you currently either need to manually flash and reset (a time consuming and error prone process) or set up an instance of <a href="https://github.com/djmitche/mozpool">mozpool</a> (which I understand is quite complicated).</p>

<p>The main use case I see with eideticker-on-panda would be where we wanted to run a suite of tests on checkin (in tbpl-like fashion) and we&#8217;d need to scale to many devices. While cool, this sounds like an expensive project (both in terms of time and hardware) and I think we&#8217;d do better with getting something slightly smaller-scale running first.</p>

<p>So, the real question is whether or not the capture produced by the Elmo is amenable to the same analysis that we do on the raw HDMI output. At the very least, some of eideticker&#8217;s image analysis code will have to be adapted to handle a much &#8220;noisier&#8221; capture. As opposed to capturing the raw HDMI signal, we now have to deal with the real world and its irritating fluctuations in ambient light levels and all that the rest. I have no doubt it is *possible* to compensate for this (after all this is what the human eye/brain does all the time), but the question is how much work it will be. Can&#8217;t speak for anyone else at Mozilla, but I&#8217;m not sure if I really have the time to start a Ph.D-level research project in computational vision. 😉 I&#8217;m optimistic that won&#8217;t be necessary, but we&#8217;ll just have to wait and see.</p>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Android.html">Android</a>, <a href="/tags/Mozilla.html">Mozilla</a></span></p>
    <h2><a href='/blog/2012/10/using-the-dm-utility-to-interact-with-android-or-firefoxos-devices/'>Using the dm utility to interact with Android or FirefoxOS devices</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Oct 18th, 2012</p>
  </header>

<p>I promised a few people I&#8217;d blog about this, so here you go.</p>

<p>To help with the business of making Android or FirefoxOS devices do our bidding, <a href="https://wiki.mozilla.org/Auto-tools">Mozilla Automation &#38; Tools</a> developed a Python library called <a href="https://github.com/mozilla/mozbase/tree/master/mozdevice">mozdevice</a> which allows you to control these devices either using the Android Debug Bridge protocol (which is actually not Android specific: FirefoxOS devices use it too) or the <a href="https://wiki.mozilla.org/Auto-tools/Projects/SUTAgent">System Under Test protocol</a> (a Mozilla-specific thing).</p>

<p>Anyone familiar with debugging these devices is doubtless familiar with adb, which provides a command line interface that allows you to push/pull files, run a shell, etc. To help test our python code (as well as expand the scope of what&#8217;s possible on the command line), I created a similar utility a few months ago called &#8220;dm&#8221; which provides a command-line interface to the aforementioned mozdevice code. It&#8217;s shipped as part of mozdevice, and testing it out is pretty simple if you have virtualenv installed:</p>

<pre><code>virtualenv mozdevice
cd mozdevice
./bin/pip install mozdevice
source bin/activate
dm --help</code></pre>

<p>I generally use this utility for two things:</p>

<ol>
 <li>
  <p>Testing out mozdevice code. For example, today we discovered an (unfortunate) <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=803177">bug</a> in devicemanagerADB&#8217;s killProcess routine. It was easy to verify both the problem and my fix did what I expected by starting my custom build of fennec and running this command:</p>
  <pre><code>dm --package-name org.mozilla.fennec_wlach killapp org.mozilla.fennec_wlach</code></pre>
  <p>(yes, it&#8217;s a bit unfortunate that this bug occurred in the first place: devicemanagerADB really needs unit tests)</p></li>
 <li>
  <p>Day-to-day menial tasks, like getting device info/status, capturing screenshots, etc. You can get a full list of what this utility is capable of by running &#8211;help. E.g.:</p>
  <p>``` (mozbase)wlach@eideticker:~/src/eideticker$ dm &mdash;help Usage: dm [options] &lt;command&gt; [&lt;args&gt;]</p></li></ol>

<p>device commands:  info [os|id|uptime|systime|screen|memory|processes] - get  information on a specified aspect of the device (if no argument  given, print all available information)  install &lt;file&gt; - push this package file to the device and install it  killapp &lt;process name&gt; - kills any processes with a particular name  on device  launchapp &lt;appname&gt; &lt;activity name&gt; &lt;intent&gt; &lt;URL&gt; - launches  application on device  ls &lt;remote&gt; - list files on device  ps - get information on running processes on device  pull &lt;local&gt; [remote] - copy file/dir from device  push &lt;local&gt; &lt;remote&gt; - copy file/dir to device  rm &lt;remote&gt; - remove file from device  rmdir &lt;remote&gt; - recursively remove directory from device  screencap &lt;png file&gt; - capture screenshot of device in action  shell &lt;command&gt; - run shell command on device</p>

<p>Options:  -h, &mdash;help show this help message and exit  -v, &mdash;verbose Verbose output from DeviceManager  &mdash;host=HOST Device hostname (only if using TCP/IP)  -p PORT, &mdash;port=PORT Custom device port (if using SUTAgent or adb-over-tcp)  -m DMTYPE, &mdash;dmtype=DMTYPE  DeviceManager type (adb or sut, defaults to adb)  -d HWID, &mdash;hwid=HWID HWID  &mdash;package-name=PACKAGENAME  Packagename (if using DeviceManagerADB) ```</p>

<pre><code>Before you ask, yes, it&amp;#8217;s technically possible to do much of this with the original adb utility. But (1) some of our internal stuff can&amp;#8217;t use adb a variety of reasons and (2) some of the tasks above (e.g. launching an app, getting a screenshot) involve considerably more typing with adb than with dm. So it&amp;#8217;s still a win. &lt;/li&gt; &lt;/ol&gt; 

Happy command-lining!</code></pre>

</article>

<article>
  <header>
    <p><span class="tags"><a href="/tags/Mozilla.html">Mozilla</a>, <a href="/tags/Python.html">Python</a></span></p>
    <h2><a href='/blog/2012/10/catching-problems-early-with-python/'>Catching problems early with python</a></h2>
    <p class='index-date'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Oct 15th, 2012</p>
  </header>

<p>Just a few quick notes on how to avoid a class of errors I&#8217;ve been seeing in Mozilla&#8217;s automation over the last year. Since python interprets code dynamically, it&#8217;s pretty easy for problems like undefined variables to slip through, especially if they&#8217;re in a codepath that isn&#8217;t frequently tested. The most recent example I found was in some cleanup-after-error code for remote mochitest/reftest, which tried to call &#8220;self.cleanup&#8221; from a standalone method.</p>

<pre><code>def main():
      ...
      try:
        dm.recordLogcat()
        retVal = mochitest.runTests(options)
        logcat = dm.getLogcat()
      except:
        print "TEST-UNEXPECTED-FAIL | %s | Exception caught while running tests." % sys.exc_info()[1]
        mochitest.stopWebServer(options)
        mochitest.stopWebSocketServer(options)
        try:
            self.cleanup(None, options)
        except:
            pass
</code></pre>

<p><a href="http://hg.mozilla.org/mozilla-central/file/942ed5747b63/testing/mochitest/runtestsremote.py#l481">testing/mochitest/runtestsremote.py</a></p>

<p>We&#8217;re calling cleanup as if it were a class variable, but we&#8217;re not inside any class! It&#8217;s easy to see what will happen if you try to run some similar code from the python console:</p>

<pre><code>&gt;&gt;&gt; self.cleanup()
Traceback (most recent call last):
  File "&amp;lt;stdin&gt;", line 1, in &amp;lt;module&gt;
NameError: name 'self' is not defined</code></pre>

<p>However, because we&#8217;re in a blanket try&#8230;except, we will never see an error. The cleanup code will never be called, instead the exception is immediately caught and subsequently ignored. Probably not the end of the world in this case (there are other parts of our mobile automation which will perform the same cleanup later), but it&#8217;s easy to imagine where this would be a more serious problem.</p>

<p>There&#8217;s two very easy ways to help stop errors like this before they hit our code:</p>

<ol>
 <li>
  <p>Try to avoid using a blanket try&#8230;except. In addition to catching legitimate problems which we want to ignore (in the remote case for example, devicemanager exceptions), it also catches (and thus obscures) things like syntax, name, or type errors. Instead, try just catching the specific exception you&#8217;re looking for. For example, we might rewrite the case above as:</p>``` try:</li></ol>

<p> mochitest.cleanup(None, options) except devicemanager.DMError:  print &ldquo;WARNING: Device error while cleaning up&rdquo; <code>2. pyflakes, pyflakes, pyflakes. [Pyflakes][2] is a fantastic tool for analyzing your python code for common problems. It&amp;#8217;s kind of analagous to [jslint][3], for those of you familiar with that. Here&amp;#8217;s what happens when we run pyflakes against the offending code:</code> wlach@eideticker:~/src/mozilla-central$ pyflakes testing/mochitest/runtestsremote.py  testing/mochitest/runtestsremote.py:7: &lsquo;time&rsquo; imported but unused testing/mochitest/runtestsremote.py:481: undefined name &lsquo;self&rsquo; testing/mochitest/runtestsremote.py:500: undefined name &lsquo;self&rsquo; ```</p>

<pre><code>I&amp;#8217;ve found pyflakes to be an indispensable part of my workflow. I generally run it after making any substantial change to a python file, and certainly before pushing anything to be consumed by others.</code></pre>

<p>Ultimately there&#8217;s no substitute for actually thoroughly testing your code, no matter what language you&#8217;re using. But using the right techniques and tools can certainly make your life easier.</p>

<p>[ for those wondering, a fix for the issue mentioned in this post is part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=801652">bug 801652</a> ]</p>

</article>

<footer>
 <ul class="pagination">
  <li><a href="/tags/Mozilla-3.html">
    <quote>&larr;</quote></a></li>
  <li><a href="/tags/Mozilla.html">1</a></li>
  <li><a href="/tags/Mozilla-2.html">2</a></li>
  <li><a href="/tags/Mozilla-3.html">3</a></li>
  <li class="active"><a href="/tags/Mozilla-4.html">4</a></li>
  <li><a href="/tags/Mozilla-5.html">5</a></li>
  <li><a href="/tags/Mozilla-6.html">6</a></li>
  <li><a href="/tags/Mozilla-7.html">7</a></li>
  <li><a href="/tags/Mozilla-5.html">
    <quote>&rarr;</quote></a></li></ul></footer>
        </div>
      </div>
      <footer>
        <p>Site generated by <a href="https://github.com/greghendershott/frog">Frog</a>,
          using <a href="https://getbootstrap.com">Bootstrap</a>.</p>
        <p>Post content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
      </footer>
    </div>
    <!-- </body> JS -->
    <script type="text/javascript" src="//code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  </body>
</html>